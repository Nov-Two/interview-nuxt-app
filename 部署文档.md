# Nuxt 应用自动化部署指南

本文档将指导你如何将 Nuxt 应用自动部署到你的服务器 (8.134.131.208)。

## 1. 项目配置变更

为了支持部署到子路径 `/nuxt/`，我们已经修改了 `nuxt.config.ts`：

```typescript
export default defineNuxtConfig({
  app: {
    baseURL: '/nuxt/'
  },
  // ... 其他配置
})
```

**注意**：在本地开发时，访问地址也会变为 `http://localhost:3000/nuxt/`。

## 2. GitHub Actions 配置

我们在 `.github/workflows/deploy.yml` 中创建了自动化部署流程。为了使其工作，你需要配置 GitHub 仓库的 **Secrets**。

1. 进入 GitHub 仓库页面。
2. 点击 **Settings** -> **Secrets and variables** -> **Actions** -> **New repository secret**。
3. 添加以下三个密钥：


| Name              | Value           | 说明                           |
| ----------------- | --------------- | ------------------------------ |
| `SERVER_HOST`     | `8.134.131.208` | 服务器 IP 地址                 |
| `SERVER_USER`     | `root`          | 服务器登录用户名 (通常是 root) |
| `SERVER_PASSWORD` | ``              | 服务器登录密码                 |

## 3. 服务器首次设置

在第一次自动部署之前，你需要手动登录服务器并克隆代码仓库，因为 GitHub Action 需要一个存在的 Git 目录来执行 `git pull`。

### 步骤 1：登录服务器

使用终端或 SSH 客户端登录：

```bash
ssh root@8.134.131.208
```

### 步骤 2：安装必要软件 (如果尚未安装)

确保服务器已安装 `git` 和 `docker`。

```bash
# 检查是否安装
git --version
docker --version

# 如果未安装 (以 Ubuntu/Debian 为例):
apt-get update
apt-get install -y git docker.io
```

### 步骤 3：克隆代码仓库

将代码克隆到 `/home/interview-nuxt-app` 目录。
**注意**：由于是私有仓库或需要权限，你可能需要配置 SSH Key 或使用 HTTPS + Token。

```bash
cd /home
# 替换为你的 GitHub 仓库地址
git clone https://github.com/你的用户名/interview-nuxt-app.git
```

如果提示输入密码，对于 GitHub 现在的私有仓库，通常需要使用 **Personal Access Token** 而不是账户密码。

### 步骤 4：验证 Docker 权限

确保当前用户有权限运行 Docker 命令。如果是 root 用户通常没问题。

## 4. 触发部署

完成上述设置后，只需将代码提交并推送到 `main` 或 `master` 分支，GitHub Actions 就会自动触发：

```bash
git add .
git commit -m "feat: 配置自动化部署"
git push origin main
```

## 5. 验证部署

部署完成后，稍等几分钟（构建镜像需要时间），访问以下地址查看效果：

**http://8.134.131.208:3002/nuxt/**

## 常见问题排查

1. **GitHub Action 连接失败**：检查 `SERVER_HOST`、`SERVER_USER` 和 `SERVER_PASSWORD` 是否正确。
2. **Git Pull 失败**：登录服务器进入 `/home/interview-nuxt-app` 手动执行 `git pull` 看是否有权限错误。
3. **Docker 构建失败**：查看 GitHub Actions 的详细日志。
